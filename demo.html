<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body, .container-fluid{
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div id="map"></div>
        <form onsubmit="submitFn(this,event);"> <!-- submitFn 功能?? -->
          <main class="search-wrapper">
           <div class="input">
             <input type="text" class="input-search" placeholder="搜索景点" data-bind="value:searchText, valueUpdate:'keyup'"/>
             <button type="button" class="search-icon" onclick="searchToggle(this,event);"></button>

           </div>
           <section class="result_container">
             <ul class="" role="menu" data-bind="foreach:locationName" >
               <!-- bootstrap下拉菜单 -->
               <li calss="start">
                 <a href="#" data-bind="click:$parent.select" style="color:white;">
                   <i class="icon-pointer"> </i>
                   <span class="title" data-bind="text:title, click:$parent.select">

                   </span>
                 </a>
               </li>
             </ul>
           </section>
          </main>
        </form>
    </div>



    <script>
      var map;
      var markers = [];

      var locations = [
        { title: "myLatlng1",
          location: {lat: 30.245, lng: 120.162}
        },{
          title: "myLatlng2",
          location: {lat: 30.256, lng: 120.161}
        },{
          title: "myLatlng3",
          location: {lat: 30.247, lng: 120.161}
        }
      ];

      // var myLatlng = {lat: 30.245, lng: 120.162};
      // var myLatlng2 = {lat: 30.255, lng: 120.162};

      function initMap() {
        //设置map地图样式
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 30.245, lng: 120.162},
          zoom: 17,
          streetViewControl: true,
          rotateControl: true,
          zoomControl: true,
          scaleControl: true,

          mapTypeControl: true,
          mapTypeControlOptions:{
            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
            //mapTypeIds: ["roadmap","terrain"]
          }
        });

        //creat markers
        locations.forEach(function(item,index,arr){
          var marker = new google.maps.Marker({
            position:item.location,
            map:map,
            title:item.title,
            animation:google.maps.Animation.DROP
          });
          markers.push(marker);

          marker.addListener("click",function(){
            bounce(this);
            infoWindow.open(map,marker);
          });

        });

        //bounce animation
        function bounce(marker){
          marker.setAnimation(google.maps.Animation.BOUNCE);
          window.setTimeout(function(){
            marker.setAnimation(null);   //2s后标记停止bounce
          },2000)
        };

        //creat bounds 同时map会自动将视图范围包含所有markers
       function creatBounds(){
          var bounds = new google.maps.LatLngBounds();
          for (var i = 0; i < markers.length; i++) {
            bounds.extend(markers[i].position);   //extends this bounds to cotain the given point(https://developers.google.com/maps/documentation/javascript/reference?csw=1#LatLngBounds)合并markers.position至bounds--{f{f,d},b{f,d}}
          };
          map.fitBounds(bounds);   //使地图viewport对所有bounds可见
          console.log(bounds);
       };
       creatBounds();


//ViewModel
      var ViewModel = function () {
        var self = this;
        this.locationName=ko.observableArray(locations);
        this.searchText=ko.observable("");
        this.markerItem=ko.observableArray(markers);



      };
      ko.applyBindings(new ViewModel());

        //设置标记
        // var marker = new google.maps.Marker({
        //   position: myLatlng,
        //   map:map,
        //   title:"title",
        //   animation:google.maps.Animation.DROP
        // });

        //设置信息窗口
        // var infoWindow = new google.maps.InfoWindow({
        //   content: "zoom:" + map.getZoom(),
        //   position: myLatlng
        // });

        //traffic层
        // var transitLayer = new google.maps.TransitLayer();
        // transitLayer.setMap(map);

        //点击标记改变map中心点和大小
        // marker.addListener("click",function(){
        //   window.setTimeout(function(){
        //     map.setZoom(19);
        //     map.setCenter(myLatlng2);
        //   },500);
        //   //infoWindow.open(map,marker);
        // });

       //map中心改变后地图panTo 重设的标记点
        // map.addListener("center_changed",function(){
        //   window.setTimeout(function(){
        //     map.panTo(marker.setPosition(myLatlng2));
        //   },3000);
        // });
     //map的zoom改变后 信息窗口信息改变
        // map.addListener("zoom_changed",function(){
        //   window.setTimeout(function(){
        //     infoWindow.setContent("zoom:" + map.getZoom());
        //   },3000);
        // });


      }

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAImIIBU0qxkhLWU5Ema38mQVFjSUMSN4w&callback=initMap"
    async defer></script>
    <script src="bootstrap/js/bootstrap.min.js">
    </script>

  </body>
</html>
